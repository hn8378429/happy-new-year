<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÜ Global New Year 2026 Celebrations üåç</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&family=Dancing+Script:wght@700&family=Montserrat:wght@800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #000428 0%, #004e92 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.3;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        /* Main Canvas */
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Main Container */
        .main-container {
            position: relative;
            z-index: 2;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            width: 100%;
            max-width: 1200px;
            animation: headerGlow 3s ease-in-out infinite alternate;
        }

        @keyframes headerGlow {
            from {
                text-shadow: 0 0 20px #FFD700, 0 0 40px #FF4500;
            }
            to {
                text-shadow: 0 0 30px #00BFFF, 0 0 60px #FF1493;
            }
        }

        .main-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 4.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FF8C00, #FF1493, #00BFFF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
        }

        .subtitle {
            font-size: 1.8rem;
            color: #B0E0E6;
            margin-bottom: 30px;
            font-weight: 300;
        }

        .year-display {
            font-size: 10rem;
            font-weight: 800;
            margin: 20px 0;
            color: #FFD700;
            text-shadow: 0 0 50px rgba(255, 215, 0, 0.7);
            animation: yearPulse 2s infinite;
            font-family: 'Montserrat', sans-serif;
        }

        @keyframes yearPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Personal Message Section */
        .personal-section {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 30px auto;
            width: 90%;
            max-width: 800px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.2);
        }

        .section-title {
            color: #FFD700;
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .input-field {
            flex: 1;
            min-width: 200px;
            padding: 15px 20px;
            border-radius: 50px;
            border: 2px solid rgba(255, 215, 0, 0.5);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .action-btn {
            padding: 15px 40px;
            border-radius: 50px;
            border: none;
            background: linear-gradient(45deg, #FF8C00, #FFD700);
            color: #000;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            justify-content: center;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 140, 0, 0.5);
        }

        .message-display {
            background: rgba(0, 30, 60, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            border-left: 5px solid #FFD700;
            animation: slideIn 0.5s ease-out;
            display: none;
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .greeting-text {
            font-size: 1.8rem;
            color: #FFD700;
            margin-bottom: 10px;
            font-family: 'Dancing Script', cursive;
        }

        .sender-name {
            color: #00BFFF;
            font-weight: 600;
        }

        /* World Clock Section */
        .world-clock {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            width: 90%;
            max-width: 1200px;
            margin: 40px auto;
        }

        .country-clock {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .country-clock.active {
            border-color: #FFD700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            transform: scale(1.05);
        }

        .country-clock.next {
            border-color: #FF1493;
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.5);
        }

        .flag {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .country-name {
            font-size: 1.4rem;
            margin-bottom: 10px;
            color: #FFD700;
        }

        .city-name {
            font-size: 1rem;
            color: #B0E0E6;
            margin-bottom: 15px;
        }

        .time-display {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            margin-bottom: 10px;
            font-family: 'Montserrat', sans-serif;
        }

        .countdown {
            font-size: 1.2rem;
            color: #FF1493;
            font-weight: 600;
        }

        .countdown.soon {
            animation: blink 1s infinite;
            color: #FF0000;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Countdown Timer */
        .global-countdown {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin: 30px auto;
            width: 90%;
            max-width: 800px;
            text-align: center;
            border: 2px solid rgba(0, 191, 255, 0.5);
            box-shadow: 0 0 40px rgba(0, 191, 255, 0.3);
        }

        .countdown-title {
            font-size: 2rem;
            color: #00BFFF;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .countdown-unit {
            background: rgba(0, 30, 60, 0.9);
            border-radius: 15px;
            padding: 25px 15px;
            min-width: 120px;
            border: 2px solid rgba(0, 191, 255, 0.3);
        }

        .countdown-value {
            font-size: 3.5rem;
            font-weight: 800;
            color: #FFD700;
            font-family: 'Montserrat', sans-serif;
            line-height: 1;
        }

        .countdown-label {
            font-size: 1rem;
            color: #B0E0E6;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .next-midnight {
            color: #FF1493;
            font-size: 1.2rem;
            margin-top: 25px;
            font-weight: 600;
        }

        /* Controls */
        .controls {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(15px);
            padding: 20px 30px;
            border-radius: 50px;
            border: 2px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
            z-index: 100;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 90%;
        }

        .control-btn {
            padding: 12px 25px;
            border-radius: 50px;
            border: none;
            background: linear-gradient(45deg, #4169E1, #00BFFF);
            color: white;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 191, 255, 0.5);
        }

        .control-btn.orange {
            background: linear-gradient(45deg, #FF8C00, #FFD700);
        }

        .control-btn.pink {
            background: linear-gradient(45deg, #FF1493, #FF69B4);
        }

        /* Fireworks Display */
        .fireworks-info {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(255, 20, 147, 0.5);
            z-index: 100;
            max-width: 300px;
        }

        .info-title {
            color: #FF1493;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-item {
            margin: 8px 0;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
        }

        .info-value {
            color: #FFD700;
            font-weight: 600;
        }

        /* Share Section */
        .share-section {
            position: fixed;
            top: 30px;
            left: 30px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid rgba(0, 191, 255, 0.5);
            z-index: 100;
            max-width: 300px;
        }

        .share-btn {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(45deg, #00BFFF, #1E90FF);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 191, 255, 0.4);
        }

        .share-btn.whatsapp {
            background: linear-gradient(45deg, #25D366, #128C7E);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .main-title { font-size: 2.8rem; }
            .year-display { font-size: 5rem; }
            .countdown-unit { min-width: 80px; padding: 15px 10px; }
            .countdown-value { font-size: 2.5rem; }
            .controls { bottom: 20px; padding: 15px; }
            .control-btn { padding: 10px 15px; font-size: 0.9rem; }
            .fireworks-info, .share-section {
                position: static;
                margin: 20px auto;
                max-width: 90%;
            }
            .world-clock { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="bg-animation" id="bgAnimation"></div>
    
    <!-- Canvas for Fireworks -->
    <canvas id="canvas"></canvas>
    
    <!-- Main Content -->
    <div class="main-container">
        <!-- Header -->
        <div class="header">
            <h1 class="main-title">üéä Global New Year 2026 üéä</h1>
            <p class="subtitle">Celebrating Across Time Zones üåç</p>
            <div class="year-display">2026</div>
        </div>
        
        <!-- Personal Message Section -->
        <div class="personal-section">
            <h2 class="section-title"><i class="fas fa-gift"></i> Send Personal New Year Wishes</h2>
            <div class="input-group">
                <input type="text" id="senderName" class="input-field" placeholder="Your Name" maxlength="30">
                <input type="text" id="recipientName" class="input-field" placeholder="Recipient's Name" maxlength="30">
                <button id="createGreeting" class="action-btn">
                    <i class="fas fa-magic"></i> Create Greeting
                </button>
            </div>
            <div class="message-display" id="greetingDisplay">
                <div class="greeting-text" id="greetingText"></div>
                <div>From: <span class="sender-name" id="displaySender"></span></div>
                <button id="shareGreeting" class="action-btn" style="margin-top: 15px; background: linear-gradient(45deg, #25D366, #128C7E);">
                    <i class="fab fa-whatsapp"></i> Share on WhatsApp
                </button>
            </div>
        </div>
        
        <!-- Global Countdown -->
        <div class="global-countdown">
            <h2 class="countdown-title"><i class="fas fa-globe-americas"></i> Next New Year Countdown</h2>
            <div class="countdown-timer">
                <div class="countdown-unit">
                    <div class="countdown-value" id="countdownHours">00</div>
                    <div class="countdown-label">Hours</div>
                </div>
                <div class="countdown-unit">
                    <div class="countdown-value" id="countdownMinutes">00</div>
                    <div class="countdown-label">Minutes</div>
                </div>
                <div class="countdown-unit">
                    <div class="countdown-value" id="countdownSeconds">00</div>
                    <div class="countdown-label">Seconds</div>
                </div>
            </div>
            <div class="next-midnight" id="nextLocation">Next midnight in: <span id="nextCountry">Loading...</span></div>
        </div>
        
        <!-- World Clocks -->
        <div class="world-clock" id="worldClocks">
            <!-- Countries will be dynamically added here -->
        </div>
    </div>
    
    <!-- Fireworks Info -->
    <div class="fireworks-info">
        <h3 class="info-title"><i class="fas fa-fire"></i> Fireworks Display</h3>
        <div class="info-item">
            <span>Active Fireworks:</span>
            <span class="info-value" id="activeFireworks">0</span>
        </div>
        <div class="info-item">
            <span>Particles:</span>
            <span class="info-value" id="particleCount">0</span>
        </div>
        <div class="info-item">
            <span>Current Country:</span>
            <span class="info-value" id="currentCountry">Detecting...</span>
        </div>
        <div class="info-item">
            <span>Local Time:</span>
            <span class="info-value" id="localTime">00:00:00</span>
        </div>
    </div>
    
    <!-- Share Section -->
    <div class="share-section">
        <h3 style="color: #00BFFF; margin-bottom: 15px;"><i class="fas fa-share-alt"></i> Share Celebration</h3>
        <button class="share-btn whatsapp" id="sharePage">
            <i class="fab fa-whatsapp"></i> Share This Page
        </button>
        <button class="share-btn" id="captureMoment">
            <i class="fas fa-camera"></i> Capture Moment
        </button>
    </div>
    
    <!-- Controls -->
    <div class="controls">
        <button class="control-btn orange" id="megaShow">
            <i class="fas fa-bomb"></i> Mega Fireworks Show
        </button>
        <button class="control-btn" id="autoToggle">
            <i class="fas fa-play"></i> Auto Fireworks
        </button>
        <button class="control-btn pink" id="midnightMode">
            <i class="fas fa-clock"></i> Midnight Mode
        </button>
        <button class="control-btn" id="changeTheme">
            <i class="fas fa-palette"></i> Change Theme
        </button>
    </div>

    <script>
        // =========== GLOBAL VARIABLES ===========
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let fireworks = [];
        let particles = [];
        let autoFireworks = true;
        let midnightMode = false;
        let userCountry = '';
        let userTimeZone = '';
        let nextMidnightCountry = '';
        let nextMidnightTime = null;
        let currentTheme = 0;
        let megaShowActive = false;

        // Country data with timezones and flags
        const countries = [
            { name: "New Zealand", city: "Auckland", timezone: "Pacific/Auckland", flag: "üá≥üáø", offset: 13 },
            { name: "Australia", city: "Sydney", timezone: "Australia/Sydney", flag: "üá¶üá∫", offset: 11 },
            { name: "Japan", city: "Tokyo", timezone: "Asia/Tokyo", flag: "üáØüáµ", offset: 9 },
            { name: "China", city: "Beijing", timezone: "Asia/Shanghai", flag: "üá®üá≥", offset: 8 },
            { name: "India", city: "Mumbai", timezone: "Asia/Kolkata", flag: "üáÆüá≥", offset: 5.5 },
            { name: "UAE", city: "Dubai", timezone: "Asia/Dubai", flag: "üá¶üá™", offset: 4 },
            { name: "Russia", city: "Moscow", timezone: "Europe/Moscow", flag: "üá∑üá∫", offset: 3 },
            { name: "Germany", city: "Berlin", timezone: "Europe/Berlin", flag: "üá©üá™", offset: 1 },
            { name: "UK", city: "London", timezone: "Europe/London", flag: "üá¨üáß", offset: 0 },
            { name: "Brazil", city: "Rio", timezone: "America/Sao_Paulo", flag: "üáßüá∑", offset: -3 },
            { name: "USA", city: "New York", timezone: "America/New_York", flag: "üá∫üá∏", offset: -5 },
            { name: "Mexico", city: "Mexico City", timezone: "America/Mexico_City", flag: "üá≤üáΩ", offset: -6 },
            { name: "USA", city: "Los Angeles", timezone: "America/Los_Angeles", flag: "üá∫üá∏", offset: -8 }
        ];

        const themes = [
            { bg: ['#000428', '#004e92'], particleColors: ['#FFD700', '#FF8C00', '#FF1493', '#00BFFF'] },
            { bg: ['#0f0c29', '#302b63'], particleColors: ['#FF6B6B', '#4ECDC4', '#FFE66D', '#FF9A8B'] },
            { bg: ['#232526', '#414345'], particleColors: ['#FF4081', '#7C4DFF', '#18FFFF', '#64FFDA'] },
            { bg: ['#141E30', '#243B55'], particleColors: ['#FF5252', '#FFD740', '#69F0AE', '#448AFF'] }
        ];

        // =========== INITIALIZATION ===========
        function init() {
            createStarBackground();
            setupEventListeners();
            detectUserLocation();
            updateWorldClocks();
            startCountdownTimer();
            animate();
            
            // Start auto fireworks
            setInterval(() => {
                if (autoFireworks && !megaShowActive) {
                    createRandomFirework();
                }
            }, 800);
        }

        // =========== BACKGROUND STARS ===========
        function createStarBackground() {
            const bg = document.getElementById('bgAnimation');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = `${Math.random() * 3}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 3}s`;
                bg.appendChild(star);
            }
        }

        // =========== USER LOCATION DETECTION ===========
        function detectUserLocation() {
            // Try to get location from browser
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        try {
                            const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${position.coords.latitude}&lon=${position.coords.longitude}`);
                            const data = await response.json();
                            userCountry = data.address.country || 'Unknown';
                            document.getElementById('currentCountry').textContent = userCountry;
                            
                            // Set user timezone
                            userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                            updateLocalTime();
                        } catch (error) {
                            fallbackLocation();
                        }
                    },
                    () => fallbackLocation()
                );
            } else {
                fallbackLocation();
            }
        }

        function fallbackLocation() {
            // Fallback to IP-based location
            fetch('https://ipapi.co/json/')
                .then(response => response.json())
                .then(data => {
                    userCountry = data.country_name || 'Unknown';
                    userTimeZone = data.timezone || 'UTC';
                    document.getElementById('currentCountry').textContent = userCountry;
                    updateLocalTime();
                })
                .catch(() => {
                    userCountry = 'Global';
                    userTimeZone = 'UTC';
                    document.getElementById('currentCountry').textContent = 'Global';
                    updateLocalTime();
                });
        }

        function updateLocalTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { timeZone: userTimeZone });
            document.getElementById('localTime').textContent = timeString;
            
            // Check if it's midnight in user's location
            const hours = now.getHours();
            const minutes = now.getMinutes();
            
            if (midnightMode && hours === 0 && minutes === 0) {
                triggerMidnightFireworks();
            }
        }

        // =========== WORLD CLOCKS ===========
        function updateWorldClocks() {
            const worldClocks = document.getElementById('worldClocks');
            worldClocks.innerHTML = '';
            
            let nextCountry = null;
            let minTimeToMidnight = Infinity;
            
            countries.forEach(country => {
                const now = new Date();
                const timeString = now.toLocaleTimeString('en-US', { timeZone: country.timezone });
                const dateString = now.toLocaleDateString('en-US', { 
                    timeZone: country.timezone,
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });
                
                // Calculate time to midnight
                const midnight = new Date(now.toLocaleString('en-US', { timeZone: country.timezone }));
                midnight.setHours(24, 0, 0, 0);
                const timeToMidnight = midnight.getTime() - now.getTime();
                
                // Check if this is the next midnight
                if (timeToMidnight < minTimeToMidnight && timeToMidnight > 0) {
                    minTimeToMidnight = timeToMidnight;
                    nextCountry = country;
                    nextMidnightTime = midnight;
                }
                
                // Create clock element
                const clock = document.createElement('div');
                clock.className = 'country-clock';
                
                // Check if it's active (within 10 minutes of midnight)
                const hoursToMidnight = timeToMidnight / (1000 * 60 * 60);
                if (hoursToMidnight < 0.5) {
                    clock.classList.add('active');
                    if (hoursToMidnight < 0.17) { // 10 minutes
                        clock.classList.add('next');
                    }
                }
                
                clock.innerHTML = `
                    <div class="flag">${country.flag}</div>
                    <div class="country-name">${country.name}</div>
                    <div class="city-name">${country.city}</div>
                    <div class="time-display">${timeString}</div>
                    <div class="date">${dateString}</div>
                    <div class="countdown ${hoursToMidnight < 1 ? 'soon' : ''}">
                        ${formatTimeToMidnight(timeToMidnight)} to midnight
                    </div>
                `;
                
                worldClocks.appendChild(clock);
            });
            
            // Update next midnight display
            if (nextCountry) {
                nextMidnightCountry = nextCountry.name;
                document.getElementById('nextCountry').textContent = `${nextCountry.name} (${nextCountry.city})`;
            }
        }

        function formatTimeToMidnight(ms) {
            const hours = Math.floor(ms / (1000 * 60 * 60));
            const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((ms % (1000 * 60)) / 1000);
            
            if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else if (minutes > 0) {
                return `${minutes}m ${seconds}s`;
            } else {
                return `${seconds}s`;
            }
        }

        // =========== COUNTDOWN TIMER ===========
        function startCountdownTimer() {
            setInterval(() => {
                if (nextMidnightTime) {
                    const now = new Date();
                    const timeDiff = nextMidnightTime.getTime() - now.getTime();
                    
                    const hours = Math.floor(timeDiff / (1000 * 60 * 60));
                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                    
                    document.getElementById('countdownHours').textContent = hours.toString().padStart(2, '0');
                    document.getElementById('countdownMinutes').textContent = minutes.toString().padStart(2, '0');
                    document.getElementById('countdownSeconds').textContent = seconds.toString().padStart(2, '0');
                    
                    // Trigger fireworks when close to midnight
                    if (timeDiff < 10000 && timeDiff > 0 && !megaShowActive) {
                        triggerCountdownFireworks(10 - Math.floor(timeDiff / 1000));
                    }
                }
                
                updateLocalTime();
                updateWorldClocks();
            }, 1000);
        }

        // =========== FIREWORKS SYSTEM ===========
        class Firework {
            constructor(x, y, targetX, targetY, color, type = 'normal') {
                this.x = x;
                this.y = y;
                this.startY = y;
                this.targetX = targetX;
                this.targetY = targetY;
                this.speed = 8 + Math.random() * 4;
                this.size = 4;
                this.color = color || this.getRandomColor();
                this.trail = [];
                this.exploded = false;
                this.type = type;
                this.gravity = 0.1;
                this.velocity = {
                    x: (targetX - x) / 30,
                    y: -this.speed
                };
                this.sparkle = Math.random() > 0.5;
            }

            getRandomColor() {
                return themes[currentTheme].particleColors[
                    Math.floor(Math.random() * themes[currentTheme].particleColors.length)
                ];
            }

            update() {
                if (!this.exploded) {
                    // Trail effect
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > 8) this.trail.shift();

                    // Apply gravity
                    this.velocity.y += this.gravity;
                    
                    // Move towards target
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                    
                    // Check if reached target
                    const distToTarget = Math.sqrt(
                        Math.pow(this.targetX - this.x, 2) + 
                        Math.pow(this.targetY - this.y, 2)
                    );
                    
                    if (distToTarget < 5 || this.y < this.targetY) {
                        this.explode();
                    }
                }
            }

            draw() {
                if (!this.exploded) {
                    // Draw trail
                    ctx.save();
                    for (let i = 0; i < this.trail.length; i++) {
                        const point = this.trail[i];
                        const alpha = i / this.trail.length * 0.7;
                        ctx.beginPath();
                        ctx.fillStyle = this.color.replace(')', `, ${alpha})`).replace('rgb', 'rgba');
                        ctx.arc(point.x, point.y, this.size * alpha, 0, Math.PI * 2);
                        ctx.fill();
                    }

                    // Draw main rocket with glow
                    ctx.beginPath();
                    ctx.fillStyle = this.color;
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();

                    // Glow effect
                    const gradient = ctx.createRadialGradient(
                        this.x, this.y, 0,
                        this.x, this.y, 15
                    );
                    gradient.addColorStop(0, this.color.replace(')', ', 0.7)').replace('rgb', 'rgba'));
                    gradient.addColorStop(1, this.color.replace(')', ', 0)').replace('rgb', 'rgba'));
                    
                    ctx.beginPath();
                    ctx.fillStyle = gradient;
                    ctx.arc(this.x, this.y, 15, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.restore();
                }
            }

            explode() {
                this.exploded = true;
                const particleCount = this.type === 'heart' ? 100 : 150;
                
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle(
                        this.x,
                        this.y,
                        this.color,
                        this.type,
                        this.sparkle
                    ));
                }
                
                // Play explosion sound
                playExplosionSound();
            }
        }

        class Particle {
            constructor(x, y, color, type, sparkle = false) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.type = type;
                this.size = Math.random() * 3 + 1;
                this.speed = Math.random() * 4 + 2;
                this.angle = Math.random() * Math.PI * 2;
                this.vx = Math.cos(this.angle) * this.speed;
                this.vy = Math.sin(this.angle) * this.speed;
                this.gravity = 0.05;
                this.friction = 0.97;
                this.alpha = 1;
                this.decay = Math.random() * 0.015 + 0.005;
                this.sparkle = sparkle;
                this.sparkleIntensity = Math.random() * 0.5 + 0.5;
                
                // Type-specific properties
                if (type === 'heart') {
                    this.heartSize = this.size * 2;
                }
            }

            update() {
                this.vx *= this.friction;
                this.vy *= this.friction;
                this.vy += this.gravity;
                
                this.x += this.vx;
                this.y += this.vy;
                
                this.alpha -= this.decay;
                
                return this.alpha > 0;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.fillStyle = this.color;
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 1;
                
                if (this.type === 'heart') {
                    this.drawHeart();
                } else {
                    // Sparkle effect
                    if (this.sparkle && Math.random() > 0.7) {
                        ctx.shadowBlur = 10;
                        ctx.shadowColor = this.color;
                    }
                    
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Glow effect
                ctx.beginPath();
                const gradient = ctx.createRadialGradient(
                    this.x, this.y, 0,
                    this.x, this.y, this.size * 4
                );
                gradient.addColorStop(0, this.color.replace(')', ', 0.3)').replace('rgb', 'rgba'));
                gradient.addColorStop(1, this.color.replace(')', ', 0)').replace('rgb', 'rgba'));
                ctx.fillStyle = gradient;
                ctx.arc(this.x, this.y, this.size * 4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }

            drawHeart() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.heartSize * 0.05, this.heartSize * 0.05);
                ctx.rotate(Math.PI);
                
                ctx.beginPath();
                for (let i = 0; i < Math.PI * 2; i += 0.01) {
                    const t = i;
                    const px = 16 * Math.pow(Math.sin(t), 3);
                    const py = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
                    ctx.lineTo(px, py);
                }
                ctx.closePath();
                ctx.fill();
                
                ctx.restore();
            }
        }

        // =========== FIREWORK CONTROLS ===========
        function createRandomFirework() {
            const x = Math.random() * canvas.width;
            const y = canvas.height;
            const targetY = Math.random() * canvas.height * 0.4 + 100;
            const types = ['normal', 'heart', 'normal', 'normal'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            fireworks.push(new Firework(
                x, y,
                x, targetY,
                null,
                type
            ));
        }

        function triggerMidnightFireworks() {
            megaShowActive = true;
            
            // Big explosion in center
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const x = canvas.width / 2 + (Math.random() - 0.5) * 300;
                    const y = canvas.height / 2 + (Math.random() - 0.5) * 200;
                    fireworks.push(new Firework(
                        canvas.width / 2, canvas.height,
                        x, y,
                        '#FFD700',
                        'heart'
                    ));
                }, i * 100);
            }
            
            // Surrounding fireworks
            setTimeout(() => {
                for (let i = 0; i < 30; i++) {
                    setTimeout(() => {
                        createRandomFirework();
                    }, i * 50);
                }
            }, 2000);
            
            // End mega show after 10 seconds
            setTimeout(() => {
                megaShowActive = false;
            }, 10000);
        }

        function triggerCountdownFireworks(secondsLeft) {
            // Create countdown fireworks
            const x = canvas.width / 2;
            const y = canvas.height / 3;
            
            fireworks.push(new Firework(
                x, canvas.height,
                x, y,
                secondsLeft <= 3 ? '#FF0000' : '#FFFF00',
                'normal'
            ));
            
            // Display countdown number
            if (secondsLeft <= 10 && secondsLeft > 0) {
                displayCountdownNumber(secondsLeft);
            }
        }

        function displayCountdownNumber(number) {
            ctx.save();
            ctx.font = 'bold 200px Montserrat';
            ctx.fillStyle = `rgba(255, 215, 0, ${0.3 + (10 - number) * 0.07})`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowBlur = 30;
            ctx.shadowColor = '#FFD700';
            ctx.fillText(number, canvas.width / 2, canvas.height / 2);
            ctx.restore();
        }

        function playExplosionSound() {
            // Create Web Audio API sound
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.5);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                // Sound not supported
            }
        }

        // =========== ANIMATION LOOP ===========
        function animate() {
            // Clear with fade effect
            ctx.fillStyle = `rgba(${themes[currentTheme].bg[0].slice(4, -1)}, 0.1)`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Update and draw fireworks
            fireworks.forEach((fw, index) => {
                fw.update();
                fw.draw();
                
                if (fw.exploded) {
                    fireworks.splice(index, 1);
                }
            });
            
            // Update and draw particles
            particles = particles.filter(p => p.update());
            particles.forEach(p => p.draw());
            
            // Update stats
            document.getElementById('activeFireworks').textContent = fireworks.length;
            document.getElementById('particleCount').textContent = particles.length;
            
            requestAnimationFrame(animate);
        }

        // =========== PERSONAL MESSAGES ===========
        function setupPersonalMessages() {
            const createBtn = document.getElementById('createGreeting');
            const shareBtn = document.getElementById('shareGreeting');
            const display = document.getElementById('greetingDisplay');
            const greetingText = document.getElementById('greetingText');
            const senderDisplay = document.getElementById('displaySender');
            
            createBtn.addEventListener('click', () => {
                const sender = document.getElementById('senderName').value.trim() || 'A Friend';
                const recipient = document.getElementById('recipientName').value.trim() || 'You';
                
                const greetings = [
                    `Happy New Year 2026, ${recipient}! üéâ May this year bring you endless joy and success!`,
                    `Wishing ${recipient} a spectacular 2026! ‚ú® May all your dreams take flight!`,
                    `To ${recipient}, may 2026 be your best year yet! Full of love, laughter, and prosperity! üåü`,
                    `New Year, New Beginnings! ${recipient}, may 2026 shower you with blessings! üéä`,
                    `Cheers to 2026, ${recipient}! ü•Ç May every moment be as bright as these fireworks!`
                ];
                
                const randomGreeting = greetings[Math.floor(Math.random() * greetings.length)];
                
                greetingText.textContent = randomGreeting;
                senderDisplay.textContent = sender;
                display.style.display = 'block';
                
                // Trigger celebration fireworks
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => createRandomFirework(), i * 300);
                }
            });
            
            shareBtn.addEventListener('click', () => {
                const text = `${greetingText.textContent}\n\nFrom: ${senderDisplay.textContent}\n\nShare the celebration: ${window.location.href}`;
                const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
                window.open(url, '_blank');
            });
        }

        // =========== EVENT LISTENERS ===========
        function setupEventListeners() {
            // Canvas click for manual fireworks
            canvas.addEventListener('click', (e) => {
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                fireworks.push(new Firework(
                    x, canvas.height,
                    x, y,
                    null,
                    Math.random() > 0.7 ? 'heart' : 'normal'
                ));
            });
            
            // Control buttons
            document.getElementById('megaShow').addEventListener('click', triggerMidnightFireworks);
            
            document.getElementById('autoToggle').addEventListener('click', function() {
                autoFireworks = !autoFireworks;
                this.innerHTML = autoFireworks ? 
                    '<i class="fas fa-pause"></i> Pause Auto' : 
                    '<i class="fas fa-play"></i> Auto Fireworks';
            });
            
            document.getElementById('midnightMode').addEventListener('click', function() {
                midnightMode = !midnightMode;
                this.innerHTML = midnightMode ? 
                    '<i class="fas fa-moon"></i> Midnight Active' : 
                    '<i class="fas fa-clock"></i> Midnight Mode';
            });
            
            document.getElementById('changeTheme').addEventListener('click', () => {
                currentTheme = (currentTheme + 1) % themes.length;
                document.body.style.background = `linear-gradient(135deg, ${themes[currentTheme].bg[0]} 0%, ${themes[currentTheme].bg[1]} 100%)`;
            });
            
            // Share buttons
            document.getElementById('sharePage').addEventListener('click', () => {
                const text = `üéÜ Join me in celebrating New Year 2026 with this amazing fireworks show! ${window.location.href}`;
                const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
                window.open(url, '_blank');
            });
            
            document.getElementById('captureMoment').addEventListener('click', () => {
                // Create a temporary canvas to capture current frame
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                const tempCtx = tempCanvas.getContext('2d');
                
                // Draw current frame
                tempCtx.fillStyle = `linear-gradient(135deg, ${themes[currentTheme].bg[0]} 0%, ${themes[currentTheme].bg[1]} 100%)`;
                tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                tempCtx.drawImage(canvas, 0, 0);
                
                // Add text
                tempCtx.font = 'bold 40px Montserrat';
                tempCtx.fillStyle = '#FFD700';
                tempCtx.textAlign = 'center';
                tempCtx.fillText('Happy New Year 2026!', tempCanvas.width/2, 50);
                
                // Convert to image and download
                const link = document.createElement('a');
                link.download = 'new-year-2026-fireworks.png';
                link.href = tempCanvas.toDataURL('image/png');
                link.click();
            });
            
            // Window resize
            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
            
            // Setup personal messages
            setupPersonalMessages();
        }

        // =========== START EVERYTHING ===========
        window.addEventListener('load', init);
    </script>
</body>
</html>
